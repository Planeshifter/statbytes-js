<link rel="import" href="../polymer/polymer.html">
<dom-module id="polymer-codebox">
	<template>
		<style>
			body {
				text-align: left;
			}
			#code {
				width: 500px;
				height: 200px;
				font: 22px "Monaco","Menlo","Ubuntu Mono","Consolas","source-code-pro", monospace !important;
			}
			#output {
				background-color: white;
				color: black;
				border: 1px solid black;
				width: 100%;
				overflow: auto;
				padding: 5px;
				font-family: monospace, sans-serif;
				font-size: 22px;
			}
		</style>
		<div id="main">
			<span>Code:</span>
			<div id="code">
				{{code:input}}
			</div>
			<span>Output:</span>
			<div id="output">
			</div>
		</div>
	</template>
	<script src="vendor/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
	<script>
	Polymer({
		is: 'polymer-codebox',
		properties: {
			backgroundColor: {
				type: String,
				value: '#FFFFFF'
			},
			code: {
				type: String
			},
			width: {
				type: String,
				value: '500px',
				observer: '_widthChanged'
			},
			editor: {
				type: Object
			}
		},
		_refresh: function() {
			var code,
				evalFun,
				elem;
			code = this.editor.getValue();
			try {
				elem = this.$.output;
				elem.innerHTML = JSON.stringify( eval( code ), function replacer( key, val ) {
					return val.toFixed ? Number( val.toFixed(4) ) : val;
				}, 1 );
			} catch ( err ) {
				elem = this.$.output;
				elem.innerHTML = 'Invalid expression';
			}
		},
		_widthChanged: function( newValue, oldValue ) {
			this.$.main.style.width = newValue;
		},
		_init: function() {
			var self = this;
			this.editor = ace.edit( this.$.code );
			this.editor.setTheme( 'ace/theme/chrome' );
			this.editor.getSession().setMode( 'ace/mode/javascript' );
			this.editor.getSession().on( 'change', function(e) {
				self._refresh();
			});
			this.editor.session.setNewLineMode( 'unix' );
			this.editor.setValue( this.code );
		},
		ready: function() {
			this._init();
		}
	});
	</script>
</dom-module>
